{
  "nodes": [
    {
      "parameters": {
        "httpMethod": "POST",
        "path": "037ed99a-21d5-40c0-b285-a8362db2ffcc",
        "options": {}
      },
      "type": "n8n-nodes-base.webhook",
      "typeVersion": 2,
      "position": [
        -1616,
        288
      ],
      "id": "8e59d208-55c1-4a06-a120-9da72958ac10",
      "name": "Webhook",
      "webhookId": "037ed99a-21d5-40c0-b285-a8362db2ffcc"
    },
    {
      "parameters": {
        "method": "POST",
        "url": "https://api-alimtalk.cloud.toast.com/alimtalk/v2.0/appkeys/YuIB1lEDj8vuqME2/messages",
        "authentication": "genericCredentialType",
        "genericAuthType": "httpCustomAuth",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json;charset=UTF-8"
            },
            {
              "name": "X-Secret-Key",
              "value": "BqbvtCkwuidB28H7cuoYGheQ8SyEWOWw"
            },
            {
              "name": "X-App-Key",
              "value": "YuIB1lEDj8vuqME2"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "senderKey",
              "value": "7780249050d98477b04a1b589e4794c8ac1f7a78"
            },
            {
              "name": "templateCode",
              "value": "Math4U-edu-2025002"
            },
            {
              "name": "recipientList",
              "value": "={{ $json.finalJson }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        -352,
        272
      ],
      "id": "492305e6-6ca1-4a90-800e-7131f3643c4f",
      "name": "HTTP Request",
      "credentials": {
        "httpCustomAuth": {
          "id": "kCMpN7b6ZtLpHBDn",
          "name": "Custom Auth account"
        }
      }
    },
    {
      "parameters": {
        "resource": "databasePage",
        "operation": "update",
        "pageId": {
          "__rl": true,
          "value": "={{ $('Webhook').item.json.body.data.id }}",
          "mode": "id"
        },
        "propertiesUi": {
          "propertyValues": [
            {
              "key": "ë³´ê³ ì„œ ë°œì†¡|checkbox",
              "checkboxValue": true
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.notion",
      "typeVersion": 2.2,
      "position": [
        -112,
        272
      ],
      "id": "ae4482f6-05e6-4b40-aabc-d1fdd52974de",
      "name": "Notion",
      "credentials": {
        "notionApi": {
          "id": "q0CR8H0tBmQfGXS5",
          "name": "Notion account"
        }
      }
    },
    {
      "parameters": {
        "jsCode": "const data = $json.body.data.properties;\n\n// ğŸ“Œ ê³µí†µ íŒŒë¼ë¯¸í„°\nconst commonParams = {\n  url_day: $json.body.data.id,\n  í•™ìƒì´ë¦„: data[\"í•™ìƒì´ë¦„(S)\"].formula.string,\n  ìˆ˜ì—…ë‚ ì§œ: data[\"ìˆ˜ì—…ì¼ì‹œ(S)\"].formula.string,\n  ìš”ì¼: data[\"ìš”ì¼\"].formula.string,\n  ìˆ˜ì—…íšŒì°¨: data[\"ìˆ˜ì—…íšŒì°¨(S)\"].formula.string,\n  ê³¼ì •: data[\"ê³¼ì •(S)\"].formula.string,\n  ìˆ˜ì—…ë‚´ìš©: data[\"ì§„ë„/ìˆ˜ì—… ë‚´ìš©\"].rollup.array[0]?.rich_text[0]?.plain_text || \"\"\n};\n\n// ğŸ“Œ ìˆ˜ì‹ ì ë°°ì—´\nconst list = [];\n\n// ì—°ë½ì²˜1 (í•„ìˆ˜)\nif (data[\"í•™ë¶€ëª¨ì—°ë½ì²˜ 1(S)\"].formula.string) {\n  list.push({\n    recipientNo: data[\"í•™ë¶€ëª¨ì—°ë½ì²˜ 1(S)\"].formula.string,\n    templateParameter: commonParams\n  });\n}\n\n// ì—°ë½ì²˜2 (ìˆìœ¼ë©´ ì¶”ê°€)\nif (data[\"í•™ë¶€ëª¨ì—°ë½ì²˜ 2(S)\"].formula.string) {\n  list.push({\n    recipientNo: data[\"í•™ë¶€ëª¨ì—°ë½ì²˜ 2(S)\"].formula.string,\n    templateParameter: commonParams\n  });\n}\n\n// ğŸ“Œ ìˆ«ìë§Œ ì¶”ì¶œí•˜ëŠ” í•¨ìˆ˜\nfunction extractNumber(str) {\n  const match = (str || \"\").match(/\\d+/);\n  return match ? parseInt(match[0], 10) : null;\n}\n\n// ìˆ˜ì—…íšŒì°¨(S) ìˆ«ì\nconst numFromSession = extractNumber(data[\"ìˆ˜ì—…íšŒì°¨(S)\"].formula.string);\n// ê³¼ì •(S) ìˆ«ì\nconst numFromCourse = extractNumber(data[\"ê³¼ì •(S)\"].formula.string);\n\n// ë¹„êµ ê²°ê³¼\nlet sendPaymentNotice = false;\nif (numFromSession !== null && numFromCourse !== null && numFromSession === numFromCourse) {\n  sendPaymentNotice = true;\n}\n\n// ìµœì¢… ê²°ê³¼ ë¦¬í„´\nreturn [{\n  json: {\n    recipientList: list,\n    sendPaymentNotice\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        -1376,
        288
      ],
      "id": "c0b16b68-a758-4e4b-9ec5-c5e6973f7226",
      "name": "Code"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "fde62cf0-98f4-4e3c-9b37-a458a8fc29fc",
              "name": "finalJson",
              "value": "={{ $json.recipientList }}",
              "type": "string"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.4,
      "position": [
        -1152,
        288
      ],
      "id": "d9b13a80-6776-4c17-b5f2-6411cccf1f55",
      "name": "Edit Fields"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "4d236c18-3c4d-4037-ba27-d4b21d4dfa4f",
              "leftValue": "={{ $now.hour }}",
              "rightValue": 15,
              "operator": {
                "type": "number",
                "operation": "gte",
                "name": "filter.operator.gte"
              }
            },
            {
              "id": "1861802f-f498-47dd-b191-9d0b2d782390",
              "leftValue": "={{ $now.hour }}",
              "rightValue": 22,
              "operator": {
                "type": "number",
                "operation": "smaller",
                "name": "filter.operator.smaller"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -928,
        288
      ],
      "id": "6138e639-95cf-4b52-8378-8f18fd1d0386",
      "name": "ì˜¤í›„ 3ì‹œ-10ì‹œ ì‚¬ì´ì¸ê°€?"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "4d236c18-3c4d-4037-ba27-d4b21d4dfa4f",
              "leftValue": "={{ $now.hour }}",
              "rightValue": 22,
              "operator": {
                "type": "number",
                "operation": "gte",
                "name": "filter.operator.gte"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -720,
        464
      ],
      "id": "a1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5d",
      "name": "ë°¤ 10ì‹œ ì´í›„ì¸ê°€?"
    },
    {
      "parameters": {
        "resume": "specificTime",
        "dateTime": "={{ luxon.DateTime.fromISO($workflow.startedAt).setZone('Asia/Seoul').plus({ days: 1 }).set({ hour: 15, minute: 0, second: 0, millisecond: 0 }).toUTC().toFormat('yyyy-MM-dd\'T\'HH:mm:ss') }}"
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -520,
        368
      ],
      "id": "c4f1172e-eb63-4367-9810-4bc5a56eb211",
      "name": "ë‹¤ìŒë‚  3ì‹œê¹Œì§€ ëŒ€ê¸°",
      "webhookId": "a8731fd5-336a-4876-80e5-494a92dfe3e1"
    },
    {
      "parameters": {
        "resume": "specificTime",
        "dateTime": "={{ luxon.DateTime.fromISO($workflow.startedAt).setZone('Asia/Seoul').set({ hour: 15, minute: 0, second: 0, millisecond: 0 }).toUTC().toFormat('yyyy-MM-dd\'T\'HH:mm:ss') }}"
      },
      "type": "n8n-nodes-base.wait",
      "typeVersion": 1.1,
      "position": [
        -520,
        544
      ],
      "id": "b2c3d4e5-f6a7-4b8c-9d0e-1f2a3b4c5d6e",
      "name": "ë‹¹ì¼ 3ì‹œê¹Œì§€ ëŒ€ê¸°",
      "webhookId": "a8731fd5-336a-4876-80e5-494a92dfe3e2"
    }
  ],
  "connections": {
    "Webhook": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "HTTP Request": {
      "main": [
        [
          {
            "node": "Notion",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Edit Fields",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Edit Fields": {
      "main": [
        [
          {
            "node": "ì˜¤í›„ 3ì‹œ-10ì‹œ ì‚¬ì´ì¸ê°€?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ì˜¤í›„ 3ì‹œ-10ì‹œ ì‚¬ì´ì¸ê°€?": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ë°¤ 10ì‹œ ì´í›„ì¸ê°€?",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ë°¤ 10ì‹œ ì´í›„ì¸ê°€?": {
      "main": [
        [
          {
            "node": "ë‹¤ìŒë‚  3ì‹œê¹Œì§€ ëŒ€ê¸°",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "ë‹¹ì¼ 3ì‹œê¹Œì§€ ëŒ€ê¸°",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ë‹¤ìŒë‚  3ì‹œê¹Œì§€ ëŒ€ê¸°": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "ë‹¹ì¼ 3ì‹œê¹Œì§€ ëŒ€ê¸°": {
      "main": [
        [
          {
            "node": "HTTP Request",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "pinData": {},
  "meta": {
    "instanceId": "42c40a3b0e702882e5efb1e0bfa1f181054ea2f804caec8b597ee1dd0e202dec"
  }
}